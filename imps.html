<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Elemental Imp - Imps</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="flame" aria-hidden="true"></div>
  <main class="container">
    <header class="header center">
      <div class="logo">ðŸ”¥ ELEMENTAL IMP ðŸ”¥</div>
      <div class="tag">The Imp who bends the elements</div>
    </header>

    <nav class="nav-bar">
      <a href="index.html" class="btn">Home</a>
      <a href="features.html" class="btn">Features</a>
      <a href="imps.html" class="btn">Imps</a>
      <a href="levels-of-hell.html" class="btn">Levels of Hell</a>
      <a href="bestiary.html" class="btn">Bestiary</a>
      <a href="media.html" class="btn">Media</a>
      <a href="contact.html" class="btn">Contact</a>
    </nav>

    <section>
      <h2 class="logo">Main Character â€” The Imp</h2>
      <p style="margin-top:12px">
        The Imp can shift elemental forms: <strong>Fire, Water, Air, Earth, Darkness</strong>.
        Use the button below to add new forms, upload art, and write notes.
      </p>

      <div class="actions">
        <button class="add-card" data-target="#cards-imp">+ Add Imp</button>
      </div>

      <div class="cards" id="cards-imp">
        <div class="card">
          <button class="remove-card" title="Remove this form">Ã—</button>
          <div class="image" title="Click to upload or drop an image">
            Image <input type="file" accept="image/*">
          </div>
          <div class="name" contenteditable="true">Form Name (e.g., Infernal Blaze)</div>
          <div class="desc" contenteditable="true">Element: Fire â€” Describe abilities, strengths, weaknesses, and visuals.</div>
        </div>
      </div>
    </section>

    <template id="imp-card-template">
      <div class="card">
        <button class="remove-card" title="Remove this form">Ã—</button>
        <div class="image" title="Click to upload or drop an image">
          Image <input type="file" accept="image/*">
        </div>
        <div class="name" contenteditable="true">Form Name</div>
        <div class="desc" contenteditable="true">Element: (Fire/Water/Air/Earth/Darkness) â€” description...</div>
      </div>
    </template>

                <footer class="footer">
                  <div>Follow: Discord â€¢ Twitter â€¢ Steam â€¢ itch.io</div>
                </footer>
              </main>
              <script src="script.js"></script>
            </body>
            </html>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.add-card');
      if (!btn) return;

      // Find/ensure our single container
      let container = document.querySelector(btn.dataset.target || '#cards-imp');
      if (!container) {
        container = document.createElement('div');
        container.className = 'cards';
        container.id = 'cards-imp';
        btn.insertAdjacentElement('afterend', container);
      }

      // Template
      let template = document.getElementById('imp-card-template');
      if (!template) {
        template = document.createElement('template');
        template.id = 'imp-card-template';
        template.innerHTML = `
          <div class="card">
            <button class="remove-card" title="Remove this form">Ã—</button>
            <div class="image" title="Click to upload or drop an image">
              Image <input type="file" accept="image/*">
            </div>
            <div class="name" contenteditable="true">Form Name</div>
            <div class="desc" contenteditable="true">Element: (Fire/Water/Air/Earth/Darkness) â€” description...</div>
          </div>`;
        document.body.appendChild(template);
      }

      // Helpers from your main script (fallbacks if needed)
      const fileToDataURL = window.fileToDataURL || (f => new Promise(r => { const rd = new FileReader(); rd.onload = () => r(rd.result); rd.readAsDataURL(f); }));
      const setBoxImage = window.setBoxImage || ((box, src) => {
        if (!src) return;
        const input = box.querySelector('input[type="file"]');
        box.style.backgroundImage = `url(${src})`;
        box.classList.add('has-img');
        box.textContent = '';
        if (input) box.appendChild(input);
      });
      const autosave = window.autosave || (()=>{});

      function wireCard(card){
        card.querySelector('.remove-card')?.addEventListener('click', ()=>{ card.remove(); autosave(); });
        card.querySelectorAll('[contenteditable="true"]').forEach(el=>{
          el.addEventListener('input', autosave);
          el.addEventListener('blur', autosave);
        });
        const box = card.querySelector('.image');
        const input = box?.querySelector('input[type="file"]');
        if (input){
          input.addEventListener('change', async e=>{
            const f = e.target.files?.[0]; if(!f) return;
            setBoxImage(box, await fileToDataURL(f));
            autosave();
          });
        }
        ['dragenter','dragover'].forEach(ev=> box?.addEventListener(ev, e=>{ e.preventDefault(); box.style.boxShadow='0 0 18px rgba(255,69,0,.85)'; }));
        ['dragleave','drop'].forEach(ev=> box?.addEventListener(ev, e=>{ e.preventDefault(); box.style.boxShadow=''; }));
        box?.addEventListener('drop', async e=>{
          const f = e.dataTransfer?.files?.[0]; if(!f) return;
          setBoxImage(box, await fileToDataURL(f));
          autosave();
        });
      }

      const card = template.content.firstElementChild.cloneNode(true);
      wireCard(card);
      container.appendChild(card);
      card.scrollIntoView({ behavior:'smooth', block:'center' });
      autosave();
    });

    // Wire existing example card for uploads + autosave
    (function wireExisting(){
      const container = document.getElementById('cards-imp');
      if (!container) return;
      container.querySelectorAll('.card').forEach(card => {
        if (card.dataset.wired) return;
        card.dataset.wired = '1';

        // remove
        card.querySelector('.remove-card')?.addEventListener('click', ()=>{ card.remove(); (window.autosave||(()=>{}))(); });

        // text
        card.querySelectorAll('[contenteditable="true"]').forEach(el=>{
          el.addEventListener('input', window.autosave||(()=>{}));
          el.addEventListener('blur', window.autosave||(()=>{}));
        });

        // image
        const box = card.querySelector('.image');
        const input = box?.querySelector('input[type="file"]');
        if (input){
          input.addEventListener('change', async e=>{
            const f = e.target.files?.[0]; if(!f) return;
            (window.setBoxImage||((b,s)=>{ const i=b.querySelector('input[type=file]'); b.style.backgroundImage=`url(${s})`; b.classList.add('has-img'); b.textContent=''; if(i)b.appendChild(i);}))(box,
              await (window.fileToDataURL||(f=>new Promise(r=>{const rd=new FileReader(); rd.onload=()=>r(rd.result); rd.readAsDataURL(f);})))(f)
            );
            (window.autosave||(()=>{}))();
          });
        }
      });
    })();
  });
  </script>
</body>
</html>
